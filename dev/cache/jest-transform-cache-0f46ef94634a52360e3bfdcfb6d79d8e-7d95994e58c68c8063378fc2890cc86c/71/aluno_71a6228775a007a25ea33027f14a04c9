3726738544c338809f1495a749edbbb2
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addAluno = exports.fetchAlunos = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _reactNativeFlashMessage = require("react-native-flash-message");

var _db = require("../config/db");

var _types = _interopRequireDefault(require("./types"));

var fetchAlunos = function fetchAlunos() {
  return function (dispatch) {
    var itens = [];

    _db.firebaseDatabase.ref('/alunos').on('value', function (snap) {
      snap.forEach(function (snapChild) {
        var item = snapChild.val();
        item.key = snapChild.key;
        itens.push(item);
      });
      dispatch(fetchAlunoFinished(itens));
    }, function (erro) {
      return console.log(erro);
    });
  };
};

exports.fetchAlunos = fetchAlunos;

var addAluno = function addAluno(aluno) {
  return function _callee(dispatch) {
    var id;
    return _regenerator.default.async(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.prev = 0;

            if (!(aluno && !aluno.id)) {
              _context.next = 6;
              break;
            }

            _context.next = 4;
            return _regenerator.default.awrap(_db.firebaseDatabase.ref('/alunos').push(aluno));

          case 4:
            _context.next = 10;
            break;

          case 6:
            id = aluno.id;
            delete aluno.id;
            _context.next = 10;
            return _regenerator.default.awrap(_db.firebaseDatabase.ref().child('/alunos/' + id).set(aluno));

          case 10:
            _context.next = 15;
            break;

          case 12:
            _context.prev = 12;
            _context.t0 = _context["catch"](0);
            console.log(_context.t0);

          case 15:
            fetchAlunos();

          case 16:
          case "end":
            return _context.stop();
        }
      }
    }, null, this, [[0, 12]]);
  };
};

exports.addAluno = addAluno;

var fetchAlunoFinished = function fetchAlunoFinished(alunos) {
  return {
    type: _types.default.FETCH_ALUNOS,
    alunos: alunos
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsdW5vLmpzIl0sIm5hbWVzIjpbImZldGNoQWx1bm9zIiwiZGlzcGF0Y2giLCJpdGVucyIsImZpcmViYXNlRGF0YWJhc2UiLCJyZWYiLCJvbiIsInNuYXAiLCJmb3JFYWNoIiwic25hcENoaWxkIiwiaXRlbSIsInZhbCIsImtleSIsInB1c2giLCJmZXRjaEFsdW5vRmluaXNoZWQiLCJlcnJvIiwiY29uc29sZSIsImxvZyIsImFkZEFsdW5vIiwiYWx1bm8iLCJpZCIsImNoaWxkIiwic2V0IiwiYWx1bm9zIiwidHlwZSIsInR5cGVzIiwiRkVUQ0hfQUxVTk9TIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFFTyxJQUFNQSxXQUFXLEdBQUcsU0FBZEEsV0FBYztBQUFBLFNBQU0sVUFBQ0MsUUFBRCxFQUFjO0FBQzdDLFFBQUlDLEtBQUssR0FBRyxFQUFaOztBQUVBQyx5QkFDR0MsR0FESCxDQUNPLFNBRFAsRUFFR0MsRUFGSCxDQUVNLE9BRk4sRUFFZSxVQUFBQyxJQUFJLEVBQUk7QUFDbkJBLE1BQUFBLElBQUksQ0FBQ0MsT0FBTCxDQUFhLFVBQUFDLFNBQVMsRUFBSTtBQUN4QixZQUFJQyxJQUFJLEdBQUdELFNBQVMsQ0FBQ0UsR0FBVixFQUFYO0FBQ0FELFFBQUFBLElBQUksQ0FBQ0UsR0FBTCxHQUFXSCxTQUFTLENBQUNHLEdBQXJCO0FBRUFULFFBQUFBLEtBQUssQ0FBQ1UsSUFBTixDQUFXSCxJQUFYO0FBQ0QsT0FMRDtBQU9BUixNQUFBQSxRQUFRLENBQUNZLGtCQUFrQixDQUFDWCxLQUFELENBQW5CLENBQVI7QUFDRCxLQVhILEVBV0ssVUFBQVksSUFBSTtBQUFBLGFBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixJQUFaLENBQUo7QUFBQSxLQVhUO0FBWUMsR0Fmd0I7QUFBQSxDQUFwQjs7OztBQWtCQSxJQUFNRyxRQUFRLEdBQUcsU0FBWEEsUUFBVyxDQUFDQyxLQUFEO0FBQUEsU0FBVyxpQkFBT2pCLFFBQVA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBQUEsa0JBRTNCaUIsS0FBSyxJQUFJLENBQUNBLEtBQUssQ0FBQ0MsRUFGVztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLDhDQUl2QmhCLHFCQUNIQyxHQURHLENBQ0MsU0FERCxFQUVIUSxJQUZHLENBRUVNLEtBRkYsQ0FKdUI7O0FBQUE7QUFBQTtBQUFBOztBQUFBO0FBUXpCQyxZQUFBQSxFQVJ5QixHQVFwQkQsS0FBSyxDQUFDQyxFQVJjO0FBUzdCLG1CQUFPRCxLQUFLLENBQUNDLEVBQWI7QUFUNkI7QUFBQSw4Q0FXdkJoQixxQkFDSEMsR0FERyxHQUVIZ0IsS0FGRyxDQUVHLGFBQWFELEVBRmhCLEVBR0hFLEdBSEcsQ0FHQ0gsS0FIRCxDQVh1Qjs7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBaUIvQkgsWUFBQUEsT0FBTyxDQUFDQyxHQUFSOztBQWpCK0I7QUFvQi9CaEIsWUFBQUEsV0FBVzs7QUFwQm9CO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEdBQVg7QUFBQSxDQUFqQjs7OztBQXVCUCxJQUFNYSxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLENBQUFTLE1BQU07QUFBQSxTQUFLO0FBQ3BDQyxJQUFBQSxJQUFJLEVBQUVDLGVBQU1DLFlBRHdCO0FBRXBDSCxJQUFBQSxNQUFNLEVBQU5BO0FBRm9DLEdBQUw7QUFBQSxDQUFqQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNob3dNZXNzYWdlLCBoaWRlTWVzc2FnZSB9IGZyb20gXCJyZWFjdC1uYXRpdmUtZmxhc2gtbWVzc2FnZVwiO1xyXG5pbXBvcnQgeyBmaXJlYmFzZURhdGFiYXNlIH0gZnJvbSAnLi4vY29uZmlnL2RiJztcclxuXHJcbmltcG9ydCB0eXBlcyBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCBjb25zdCBmZXRjaEFsdW5vcyA9ICgpID0+IChkaXNwYXRjaCkgPT4ge1xyXG4gIHZhciBpdGVucyA9IFtdO1xyXG5cclxuICBmaXJlYmFzZURhdGFiYXNlXHJcbiAgICAucmVmKCcvYWx1bm9zJylcclxuICAgIC5vbigndmFsdWUnLCBzbmFwID0+IHtcclxuICAgICAgc25hcC5mb3JFYWNoKHNuYXBDaGlsZCA9PiB7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBzbmFwQ2hpbGQudmFsKCk7XHJcbiAgICAgICAgaXRlbS5rZXkgPSBzbmFwQ2hpbGQua2V5O1xyXG5cclxuICAgICAgICBpdGVucy5wdXNoKGl0ZW0pO1xyXG4gICAgICB9KVxyXG5cclxuICAgICAgZGlzcGF0Y2goZmV0Y2hBbHVub0ZpbmlzaGVkKGl0ZW5zKSk7XHJcbiAgICB9LCBlcnJvID0+IGNvbnNvbGUubG9nKGVycm8pKVxyXG4gIH1cclxuXHJcblxyXG5leHBvcnQgY29uc3QgYWRkQWx1bm8gPSAoYWx1bm8pID0+IGFzeW5jIChkaXNwYXRjaCkgPT4ge1xyXG4gIHRyeXtcclxuICAgIGlmIChhbHVubyAmJiAhYWx1bm8uaWQpIHtcclxuXHJcbiAgICAgIGF3YWl0IGZpcmViYXNlRGF0YWJhc2VcclxuICAgICAgICAucmVmKCcvYWx1bm9zJylcclxuICAgICAgICAucHVzaChhbHVubylcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHZhciBpZCA9IGFsdW5vLmlkO1xyXG4gICAgICBkZWxldGUgYWx1bm8uaWRcclxuXHJcbiAgICAgIGF3YWl0IGZpcmViYXNlRGF0YWJhc2VcclxuICAgICAgICAucmVmKClcclxuICAgICAgICAuY2hpbGQoJy9hbHVub3MvJyArIGlkKVxyXG4gICAgICAgIC5zZXQoYWx1bm8pXHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJybykge1xyXG4gICAgY29uc29sZS5sb2coZXJybyk7XHJcbiAgfVxyXG5cclxuICAgIGZldGNoQWx1bm9zKCk7XHJcbn1cclxuXHJcbmNvbnN0IGZldGNoQWx1bm9GaW5pc2hlZCA9IGFsdW5vcyA9PiAoe1xyXG4gIHR5cGU6IHR5cGVzLkZFVENIX0FMVU5PUyxcclxuICBhbHVub3MsXHJcbn0pOyJdfQ==